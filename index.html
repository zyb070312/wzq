<!DOCTYPE html>

<html>

    <head>

        <meta charset="utf-8" />

        <title>äº”å­æ£‹</title>

        <style type='text/css'>

            canvas {

                background-color:pink;

                display: block;

                margin: 50px auto;

                box-shadow: -2px -2px 2px #efefef, 5px 5px 5px #b9b9b9;

                cursor: pointer;

            }

            .btn-wrap { 

                display: flex; 

                flex-direction: row; 

                justify-content:center;

            }

            .btn-wrap div { 

                margin: 0 10px;

            }

            div>span {

                display: inline-block;

                padding: 10px 20px;

                color: #fff;

                background-color: #EE82EE;

                border-radius: 5px;

                cursor: pointer;

            }

            div.unable span { 

                background: #D6D6D4; 

                color: #adacaa;

            }

            #result-wrap {text-align: center;}

            body{margin:0px 0px 5px 0px;

  border:30px groove darkorchid;

  color:white;

  background-image:linear-gradient(180deg,#EE82EE,#DDA0DD,#EE82EE,#BA55D3); 

  text-align:center;

  font-size:90px;

  text-shadow:-2px 2px 1px aqua;

      }

        </style>

    </head>

    <body>

   

        <h6 id="result-wrap">--AIäº”å­æ£‹(åšæ¡‘å¼€å‘)--</h6>

        <canvas id="chess" width="450px" height="450px"></canvas>

        <div class="btn-wrap">

            <div id='restart' class="restart">

                <span>é‡æ–°å¼€å§‹</span>

            </div>

            <div id='goback' class="goback unable">

                <span>æ‚”æ£‹ï¼ˆğŸ¶ï¼‰</span>

            </div>

            <div id='return' class="return unable">

                <span>æ’¤é”€æ‚”æ£‹</span>

            </div>

        </div>

        <script type="text/javascript" charset="utf-8">

            var over = false;

            var me = true; //æˆ‘

            var _nowi = 0, _nowj = 0; //è®°å½•è‡ªå·±ä¸‹æ£‹çš„åæ ‡

            var _compi = 0, _compj = 0; //è®°å½•è®¡ç®—æœºå½“å‰ä¸‹æ£‹çš„åæ ‡

            var _myWin = [], _compWin = []; //è®°å½•æˆ‘ï¼Œè®¡ç®—æœºèµ¢çš„æƒ…å†µ

            var backAble = false, returnAble = false; 

            var resultTxt = document.getElementById('result-wrap');

            var chressBord = [];//æ£‹ç›˜

            for(var i = 0; i < 15; i++){

                chressBord[i] = [];

                for(var j = 0; j < 15; j++){

                    chressBord[i][j] = 0;

                }

            }

            //èµ¢æ³•çš„ç»Ÿè®¡æ•°ç»„

            var myWin = [];

            var computerWin = [];

            //èµ¢æ³•æ•°ç»„

            var wins = [];

            for(var i = 0; i < 15; i++){

                wins[i] = [];

                for(var j = 0; j < 15; j++){

                    wins[i][j] = [];

                }

            }

            var count = 0; //èµ¢æ³•æ€»æ•°

            //æ¨ªçº¿èµ¢æ³•

            for(var i = 0; i < 15; i++){

                for(var j = 0; j < 11; j++){

                    for(var k = 0; k < 5; k++){

                        wins[i][j+k][count] = true;

                    }

                    count++;

                }

            }

            //ç«–çº¿èµ¢æ³•

            for(var i = 0; i < 15; i++){

                for(var j = 0; j < 11; j++){

                    for(var k = 0; k < 5; k++){

                        wins[j+k][i][count] = true;

                    }

                    count++;

                }

            }

            //æ­£æ–œçº¿èµ¢æ³•

            for(var i = 0; i < 11; i++){

                for(var j = 0; j < 11; j++){

                    for(var k = 0; k < 5; k++){

                        wins[i+k][j+k][count] = true;

                    }

                    count++;

                }

            }

            //åæ–œçº¿èµ¢æ³•

            for(var i = 0; i < 11; i++){ 

                for(var j = 14; j > 3; j--){

                    for(var k = 0; k < 5; k++){

                        wins[i+k][j-k][count] = true;

                    }

                    count++;

                }

            }

            // debugger;

            for(var i = 0; i < count; i++){

                myWin[i] = 0;

                _myWin[i] = 0;

                computerWin[i] = 0;

                _compWin[i] = 0;

            }

            var chess = document.getElementById("chess");

            var context = chess.getContext('2d');

            context.strokeStyle = '#bfbfbf'; //è¾¹æ¡†é¢œè‰²

            var backbtn = document.getElementById("goback");

            var returnbtn = document.getElementById("return");

            window.onload = function(){

                drawChessBoard(); // ç”»æ£‹ç›˜

            }

            document.getElementById("restart").onclick = function(){

                window.location.reload();

            }

            // æˆ‘ï¼Œä¸‹æ£‹

            chess.onclick = function(e){

                if(over){

                    return;

                }

                if(!me){

                    return;

                }

                // æ‚”æ£‹åŠŸèƒ½å¯ç”¨

                backbtn.className = backbtn.className.replace( new RegExp( "(\\s|^)unable(\\s|$)" )," " ); 

                var x = e.offsetX;

                var y = e.offsetY;

                var i = Math.floor(x / 30);

                var j = Math.floor(y / 30);

                _nowi = i;

                _nowj = j;

                if(chressBord[i][j] == 0){

                    oneStep(i,j,me);

                    chressBord[i][j] = 1; //æˆ‘ï¼Œå·²å ä½ç½®        

                                

                    for(var k = 0; k < count; k++){ // å°†å¯èƒ½èµ¢çš„æƒ…å†µéƒ½åŠ 1

                        if(wins[i][j][k]){

                            // debugger;

                            myWin[k]++;

                            _compWin[k] = computerWin[k];

                            computerWin[k] = 6;//è¿™ä¸ªä½ç½®å¯¹æ–¹ä¸å¯èƒ½èµ¢äº†

                            if(myWin[k] == 5){

                                // window.alert('ä½ èµ¢äº†');

                                resultTxt.innerHTML = 'æ­å–œï¼Œä½ èµ¢äº†ï¼';

                                over = true;

                            }

                        }

                    }

                    if(!over){

                        me = !me;

                        computerAI();

                    }

                }         

            }

            // æ‚”æ£‹

            backbtn.onclick = function(e){

                if(!backAble) { return;}

                over = false;

                me = true;

                // resultTxt.innerHTML = 'o(â•¯â–¡â•°)oï¼Œæ‚”æ£‹ä¸­';

                // æ’¤é”€æ‚”æ£‹åŠŸèƒ½å¯ç”¨

                returnbtn.className = returnbtn.className.replace( new RegExp( "(\\s|^)unable(\\s|$)" )," " ); 

                // æˆ‘ï¼Œæ‚”æ£‹

                chressBord[_nowi][_nowj] = 0; //æˆ‘ï¼Œå·²å ä½ç½® è¿˜åŸ

                minusStep(_nowi, _nowj); //é”€æ¯æ£‹å­                                  

                for(var k = 0; k < count; k++){ // å°†å¯èƒ½èµ¢çš„æƒ…å†µéƒ½å‡1

                    if(wins[_nowi][_nowj][k]){

                        myWin[k]--;

                        computerWin[k] = _compWin[k];//è¿™ä¸ªä½ç½®å¯¹æ–¹å¯èƒ½èµ¢

                    }

                }

                // è®¡ç®—æœºç›¸åº”çš„æ‚”æ£‹

                chressBord[_compi][_compj] = 0; //è®¡ç®—æœºï¼Œå·²å ä½ç½® è¿˜åŸ

                minusStep(_compi, _compj); //é”€æ¯æ£‹å­                                  

                for(var k = 0; k < count; k++){ // å°†å¯èƒ½èµ¢çš„æƒ…å†µéƒ½å‡1

                    if(wins[_compi][_compj][k]){

                        computerWin[k]--;

                        myWin[k] = _myWin[i];//è¿™ä¸ªä½ç½®å¯¹æ–¹å¯èƒ½èµ¢

                    }

                }

                resultTxt.innerHTML = '--ç›Šæ™ºäº”å­æ£‹--';

                returnAble = true;

                backAble = false;

            }

            // æ’¤é”€æ‚”æ£‹

            returnbtn.onclick = function(e){

                if(!returnAble) { return; }

                   // æˆ‘ï¼Œæ’¤é”€æ‚”æ£‹

                chressBord[_nowi][_nowj] = 1; //æˆ‘ï¼Œå·²å ä½ç½® 

                oneStep(_nowi,_nowj,me);                              

                for(var k = 0; k < count; k++){ 

                    if(wins[_nowi][_nowj][k]){

                        myWin[k]++;

                        _compWin[k] = computerWin[k];

                        computerWin[k] = 6;//è¿™ä¸ªä½ç½®å¯¹æ–¹ä¸å¯èƒ½èµ¢

                    }

                    if(myWin[k] == 5){

                        resultTxt.innerHTML = 'æ­å–œï¼Œä½ èµ¢äº†ï¼';

                        over = true;

                    }

                }

                // è®¡ç®—æœºæ’¤é”€ç›¸åº”çš„æ‚”æ£‹

                chressBord[_compi][_compj] = 2; //è®¡ç®—æœºï¼Œå·²å ä½ç½®   

                oneStep(_compi,_compj,false);                               

                for(var k = 0; k < count; k++){ // å°†å¯èƒ½èµ¢çš„æƒ…å†µéƒ½å‡1

                    if(wins[_compi][_compj][k]){

                        computerWin[k]++;

                        _myWin[k] = myWin[k];

                        myWin[k] = 6;//è¿™ä¸ªä½ç½®å¯¹æ–¹ä¸å¯èƒ½èµ¢

                    }

                    if(computerWin[k] == 5){

                        resultTxt.innerHTML = 'o(â•¯â–¡â•°)oï¼Œè®¡ç®—æœºèµ¢äº†ï¼Œç»§ç»­åŠ æ²¹å“¦ï¼';

                        over = true;

                    }

                }

                returnbtn.className += ' '+ 'unable';

                returnAble = false;

                backAble = true;

            }

            // è®¡ç®—æœºä¸‹æ£‹

            var computerAI = function (){

                var myScore = [];

                var computerScore = [];

                var max = 0;

                var u = 0, v = 0;

                for(var i = 0; i < 15; i++){

                    myScore[i] = [];

                    computerScore[i] = [];

                    for(var j = 0; j < 15; j++){

                        myScore[i][j] = 0;

                        computerScore[i][j] = 0;

                    }

                }

                for(var i = 0; i < 15; i++){

                    for(var j = 0; j < 15; j++){

                        if(chressBord[i][j] == 0){

                            for(var k = 0; k < count; k++){

                                if(wins[i][j][k]){

                                    if(myWin[k] == 1){

                                        myScore[i][j] += 200;

                                    }else if(myWin[k] == 2){

                                        myScore[i][j] += 400;

                                    }else if(myWin[k] == 3){

                                        myScore[i][j] += 2000;

                                    }else if(myWin[k] == 4){

                                        myScore[i][j] += 10000;

                                    }

                                    

                                    if(computerWin[k] == 1){

                                        computerScore[i][j] += 220;

                                    }else if(computerWin[k] == 2){

                                        computerScore[i][j] += 420;

                                    }else if(computerWin[k] == 3){

                                        computerScore[i][j] += 2100;

                                    }else if(computerWin[k] == 4){

                                        computerScore[i][j] += 20000;

                                    }                        

                                }

                            }

                            

                            if(myScore[i][j] > max){

                                max  = myScore[i][j];

                                u = i;

                                v = j;

                            }else if(myScore[i][j] == max){

                                if(computerScore[i][j] > computerScore[u][v]){

                                    u = i;

                                    v = j;    

                                }

                            }

                            

                            if(computerScore[i][j] > max){

                                max  = computerScore[i][j];

                                u = i;

                                v = j;

                            }else if(computerScore[i][j] == max){

                                if(myScore[i][j] > myScore[u][v]){

                                    u = i;

                                    v = j;    

                                }

                            }

                            

                        }

                    }

                }

                _compi = u;

                _compj = v;

                oneStep(u,v,false);

                chressBord[u][v] = 2;  //è®¡ç®—æœºå æ®ä½ç½®

                for(var k = 0; k < count; k++){

                    if(wins[u][v][k]){

                        computerWin[k]++;

                        _myWin[k] = myWin[k];

                        myWin[k] = 6;//è¿™ä¸ªä½ç½®å¯¹æ–¹ä¸å¯èƒ½èµ¢äº†

                        if(computerWin[k] == 5){

                            resultTxt.innerHTML = 'o(â•¯â–¡â•°)oï¼Œè®¡ç®—æœºèµ¢äº†ï¼Œç»§ç»­åŠ æ²¹å“¦ï¼';

                            over = true;

                        }

                    }

                }

                if(!over){

                    me = !me;

                }

                backAble = true;

                returnAble = false;

                var hasClass = new RegExp('unable').test(' ' + returnbtn.className + ' ');

                if(!hasClass) {

                    returnbtn.className += ' ' + 'unable';

                }

            }

            //ç»˜ç”»æ£‹ç›˜

            var drawChessBoard = function() {

                for(var i = 0; i < 15; i++){

                    context.moveTo(15 + i * 30 , 15);

                    context.lineTo(15 + i * 30 , 435);

                    context.stroke();

                    context.moveTo(15 , 15 + i * 30);

                    context.lineTo(435 , 15 + i * 30);

                    context.stroke();

                }

            }

            //ç”»æ£‹å­

            var oneStep = function(i,j,me) {

                context.beginPath();

                context.arc(15 + i * 30, 15 + j * 30, 13, 0, 2 * Math.PI);// ç”»åœ†

                context.closePath();

                //æ¸å˜

                var gradient = context.createRadialGradient(15 + i * 30 + 2, 15 + j * 30 - 2, 13, 15 + i * 30 + 2, 15 + j * 30 - 2, 0);

                if(me){

                    gradient.addColorStop(0,'#0a0a0a');

                    gradient.addColorStop(1,'#636766');

                }else{

                    gradient.addColorStop(0,'#d1d1d1');

                    gradient.addColorStop(1,'#f9f9f9');

                }

                context.fillStyle = gradient;

                context.fill();

            }

            //é”€æ¯æ£‹å­

            var minusStep = function(i,j) {

                //æ“¦é™¤è¯¥åœ†

                context.clearRect((i) * 30, (j) * 30, 30, 30);

                // é‡ç”»è¯¥åœ†å‘¨å›´çš„æ ¼å­

                context.beginPath();

                context.moveTo(15+i*30 , j*30);

                context.lineTo(15+i*30 , j*30 + 30);

                context.moveTo(i*30, j*30+15);

                context.lineTo((i+1)*30 , j*30+15);

    

                context.stroke();

            }

        </script>

    </body>

</html>

